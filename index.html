<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>सन्धि शब्द संयोजकम्</title>
    <!-- Tailwind CSS for responsive styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font for a clean look */
        body {
            font-family: "Inter", sans-serif;
            background-color: #f0f4f8; /* Light gray background */
        }
        /* Style for loading indicator */
        .loader {
            border: 4px solid #f3f3f3; /* Light grey */
            border-top: 4px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 20px; /* Slightly smaller loader */
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-left: 12px; /* Increased margin */
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Basic transition for result display */
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Style for footer to stick to the bottom */
        body {
 display: flex;
 flex-direction: column;
        }
 footer {
 margin-top: auto; /* Pushes the footer to the bottom */
        }
    </style>
</head>
<div class="flex justify-center items-center pt-4">
    <img src="/download.png" alt="Logo" class="h-12"> <!-- Placeholder logo -->
</div>
<body class="flex items-center justify-center min-h-screen p-4 sm:p-6 lg:p-8">
    <div class="bg-white p-6 sm:p-8 rounded-xl shadow-lg w-full max-w-md border border-gray-200">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">सन्धि शब्द संयोजकम्</h1>

        <!-- Input for the first word -->
        <div class="mb-4">
            <label for="firstWord" class="block text-gray-700 text-sm font-semibold mb-2">प्रथमं पदम्:</label>
            <input type="text" id="firstWord" placeholder="प्रथमं पदं लिखन्तु"
 class="shadow-sm appearance-none border border-gray-300 rounded-lg w-full py-3 px-4 pr-10 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 ease-in-out">
        </div>

        <!-- Input for the second word -->
        <div class="mb-6">
            <label for="secondWord" class="block text-gray-700 text-sm font-semibold mb-2">द्वितीयं पदम्:</label>
            <input type="text" id="secondWord" placeholder="द्वितीयं पदं लिखन्तु"
 class="shadow-sm appearance-none border border-gray-300 rounded-lg w-full py-3 px-4 pr-10 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 ease-in-out">
        </div>

        <!-- Button to perform sandhi operation -->
        <button id="combineButton"
                class="w-full bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition duration-200 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 flex items-center justify-center">
                पदानां सन्धिं कुरुत
        </button>

        <!-- Display area for the sandhi result -->
        <!-- Chat History Section -->
        <div class="mt-8 mb-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b border-gray-200 pb-2">संवाद इतिहासः</h2>
            <div id="chatHistory" class="space-y-4 max-h-60 overflow-y-auto">
                <!-- Chat messages will be appended here -->
            </div>
        </div>

        <!-- Result Display Section -->
        <div id="resultContainer" class="mt-8 p-4 bg-blue-50 rounded-lg border border-blue-200 hidden fade-in relative">
            <!-- Loading indicator -->
            <div id="loadingIndicator" class="loader hidden absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-10"></div>
            <p class="text-gray-700 text-sm font-semibold mb-2">सन्धि परिणामः:</p>
            <p id="sandhiResult" class="text-2xl font-extrabold text-blue-800 break-words mb-4"></p>

            <!-- New element for Sandhi Meaning -->
            <p class="text-gray-700 text-sm font-semibold mb-2">आङ्ग्ल भाषायां अर्थः:</p>
            <p id="sandhiMeaning" class="text-lg text-gray-700 break-words mb-4"></p>

            <p class="text-gray-700 text-sm font-semibold mb-2">सन्धिप्रकारः:</p>
            <p id="sandhiType" class="text-lg text-gray-700 break-words mb-4"></p>

            <p class="text-gray-700 text-sm font-semibold mb-2">अष्टाध्यायी सूत्र नाम:</p>
            <p id="sutraName" class="text-lg text-gray-700 break-words mb-4"></p>

            <p class="text-gray-700 text-sm font-semibold mb-2">अष्टाध्यायी सूत्र संख्या:</p>
            <p id="sutraNumber" class="text-lg text-gray-700 break-words"></p>

<!-- Copy to clipboard button -->
            <button id="copyButton"
                    class="mt-4 w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-lg shadow-sm transition duration-200 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-opacity-50">
                परिणामं प्रतिलिपिं करोतु
            </button>
        </div>
        <!-- Message box for errors or important info -->
        <div id="messageBox" class="hidden mt-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg text-sm" role="alert">
            <!-- Messages will be displayed here -->
        </div>
    </div>

    <script>
        // Get references to HTML elements
        const firstWordInput = document.getElementById('firstWord');
        const secondWordInput = document.getElementById('secondWord');
        const combineButton = document.getElementById('combineButton');
        const sandhiResultDisplay = document.getElementById('sandhiResult');
        const sandhiMeaningDisplay = document.getElementById('sandhiMeaning');
        const sandhiTypeDisplay = document.getElementById('sandhiType');
        const sutraNameDisplay = document.getElementById('sutraName');
        const sutraNumberDisplay = document.getElementById('sutraNumber');
        const resultContainer = document.getElementById('resultContainer');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const clearButtons = document.querySelectorAll('.clearButton');
        const copyButton = document.getElementById('copyButton');
        const messageBox = document.getElementById('messageBox');
        const chatHistoryDiv = document.getElementById('chatHistory');

        /**
         * Displays a message in the message box.
         * @param {string} message The message to display.
         * @param {string} type The type of message ('success', 'error', 'info').
         */
        function showMessage(message, type = 'info') {
            messageBox.textContent = message;
            messageBox.classList.remove('hidden', 'bg-green-100', 'border-green-400', 'text-green-700', 'bg-red-100', 'border-red-400', 'text-red-700', 'bg-blue-100', 'border-blue-400', 'text-blue-700');
            messageBox.classList.add('block'); // Ensure it's visible

            if (type === 'success') {
                messageBox.classList.add('bg-green-100', 'border-green-400', 'text-green-700');
            } else if (type === 'error') {
                messageBox.classList.add('bg-red-100', 'border-red-400', 'text-red-700');
            } else { // default to info
                messageBox.classList.add('bg-blue-100', 'border-blue-400', 'text-blue-700');
            }

            // Hide after 5 seconds
            setTimeout(() => {
                messageBox.classList.add('hidden');
            }, 5000);
        }

        /**
         * Performs a sandhi operation by calling the Gemini API to simulate
         * a backend processing the words with a sandhi module,
         * requesting result, type, sutra name, and sutra number, and meaning.
         * @param {string} word1 The first word.
         * @param {string} word2 The second word.
         * @returns {Promise<object>} A promise that resolves with an object containing sandhiResult, sandhiMeaning, sandhiType, sutraName, and sutraNumber.
         */
        async function performSandhi(word1, word2) {
            loadingIndicator.classList.remove('hidden'); // Show loader
            combineButton.disabled = true; // Disable button
            messageBox.classList.add('hidden'); // Hide any previous messages
            resultContainer.classList.add('hidden'); // Hide results while calculating

            try {
                showMessage("सन्धि प्रक्रिया चलति...", "info");

                // Prompt the LLM to act as a sandhi calculator and return JSON
                const prompt = `Perform Sanskrit sandhi for the words "${word1}" and "${word2}". Provide the combined sandhi word, its English meaning, the type of sandhi (e.g., Vowel Sandhi, Consonant Sandhi, Visarga Sandhi), and if applicable, the Ashtadhyayi Sutra name and number that governs this sandhi. Return the response in a JSON object with keys "sandhiResult", "sandhiMeaning", "sandhiType", "sutraName", and "sutraNumber". If a sutra or meaning is not directly applicable or known, use "N/A" for its values. Do not include any other text or explanation outside the JSON.`;
                
                // Few-shot examples to guide the model on the expected output format,
                // especially for the sutraName in Sanskrit transliteration.
                const examples = [
                    {
                        input: { word1: "maha", word2: "rishi" },
                        output: { "sandhiResult": "maharṣi", "sandhiMeaning": "great sage", "sandhiType": "Vowel Sandhi", "sutraName": "Ad guṇaḥ", "sutraNumber": "6.1.87" }
                    },
                    {
                        input: { word1: "iti", word2: "ādi" },
                        output: { "sandhiResult": "ityādi", "sandhiMeaning": "and so on, et cetera", "sandhiType": "Vowel Sandhi", "sutraName": "Iko yaṇaci", "sutraNumber": "6.1.77" }
                    },
                     {
                        input: { word1: "ramā", word2: "īśa" },
                        output: { "sandhiResult": "rameśa", "sandhiMeaning": "lord of Ramā (Vishnu)", "sandhiType": "Vowel Sandhi", "sutraName": "Ād guṇaḥ", "sutraNumber": "6.1.87" }
                    }
                ];

                // For simplicity in this example, we'll send the full prompt including examples each time.
                // In a more robust chat history implementation, you would build the history
                // by appending previous interactions.
                let currentChatHistory = [{ role: "user", parts: [{ text: prompt + "\n\nHere are some examples:\n\n" + examples.map(ex => `Input: ${JSON.stringify(ex.input)}\nOutput: ${JSON.stringify(ex.output)}`).join("\n\n") }] }];


                const payload = {
                    contents: [{
                        parts: [{
                            text: prompt + "\n\nHere are some examples:\n\n" + examples.map(ex => `Input: ${JSON.stringify(ex.input)}\nOutput: ${JSON.stringify(ex.output)}`).join("\n\n")
                        }]
                    }],
                    generationConfig: {responseMimeType: "application/json"} };
                const apiKey = "AIzaSyBetJYG7cFgFjYFyPuqGYbfpHTdxPUObgg" ; // Canvas will provide this in runtime
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`API error! Status: ${response.status}, Details: ${errorText}`);
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const jsonString = result.candidates[0].content.parts[0].text;
                    const parsedJson = JSON.parse(jsonString);

                    const sandhiResult = parsedJson.sandhiResult ? parsedJson.sandhiResult.trim() : 'N/A';
                    const sandhiMeaning = parsedJson.sandhiMeaning ? parsedJson.sandhiMeaning.trim() : 'N/A';
                    const sandhiType = parsedJson.sandhiType ? parsedJson.sandhiType.trim() : 'N/A';
                    const sutraName = parsedJson.sutraName ? parsedJson.sutraName.trim() : 'N/A';
                    const sutraNumber = parsedJson.sutraNumber ? parsedJson.sutraNumber.trim() : 'N/A';

                    return { sandhiResult, sandhiMeaning, sandhiType, sutraName, sutraNumber };
                } else {
                    showMessage('सन्धि सेवायाम् अप्रत्याशितः प्रतिचारः।', 'error');
                    return { sandhiResult: 'Error', sandhiMeaning: 'N/A', sandhiType: 'N/A', sutraName: 'N/A', sutraNumber: 'N/A' };
                }


            } catch (error) {
                console.error('Error performing sandhi:', error);
                showMessage(`Error: ${error.message}. Please try again.`, 'error');
                return { sandhiResult: 'Error', sandhiMeaning: 'N/A', sandhiType: 'N/A', sutraName: 'N/A', sutraNumber: 'N/A' };
            } finally {
                loadingIndicator.classList.add('hidden'); // Hide loader
                combineButton.disabled = false; // Enable button
            }
        }

        // Add event listener to the combine button
        combineButton.addEventListener('click', async () => {
            const firstWord = firstWordInput.value.trim();
            const secondWord = secondWordInput.value.trim();

            if (!firstWord || !secondWord) { // Input validation
                resultContainer.classList.add('hidden'); // Hide results
                showMessage("सन्धिं कर्तुं कृपया उभयपदे लिखन्तु।", "error");
                return;
            }

            sandhiResultDisplay.textContent = "Calculating...";
            sandhiMeaningDisplay.textContent = "";
            sandhiTypeDisplay.textContent = "";
            sutraNameDisplay.textContent = "";

            const result = await performSandhi(firstWord, secondWord);

            if (result.sandhiResult.startsWith("Error")) {
                sandhiResultDisplay.textContent = result.sandhiResult;
                sandhiMeaningDisplay.textContent = result.sandhiMeaning;
                sandhiTypeDisplay.textContent = result.sandhiType;
                sutraNameDisplay.textContent = result.sutraName;
                sutraNumberDisplay.textContent = result.sutraNumber;
                resultContainer.classList.remove('hidden'); // Show container even on error
                resultContainer.classList.add('fade-in');
            } else {
                sandhiResultDisplay.textContent = result.sandhiResult;
                sandhiMeaningDisplay.textContent = result.sandhiMeaning;
                sandhiTypeDisplay.textContent = result.sandhiType;
                sutraNameDisplay.textContent = result.sutraName;
                sutraNumberDisplay.textContent = result.sutraNumber;
                resultContainer.classList.remove('hidden'); // Show container
                resultContainer.classList.add('fade-in');
                showMessage("सन्धि प्रक्रिया पूर्णा जाता!", "success");
                // Append interaction to chat history
                appendChatHistory(firstWord, secondWord, result);
            }
        });

        // Add event listener for the copy button
        copyButton.addEventListener('click', () => {
            // Get all relevant text for copying, separated by newlines
            const textToCopy = `Sandhi Result: ${sandhiResultDisplay.textContent}\n` +
                               `Meaning: ${sandhiMeaningDisplay.textContent}\n` +
                               `Sandhi Type: ${sandhiTypeDisplay.textContent}\n` +
                               `Ashtadhyayi Sutra Name: ${sutraNameDisplay.textContent}\n` +
                               `Ashtadhyayi Sutra Number: ${sutraNumberDisplay.textContent}`;

            if (sandhiResultDisplay.textContent && sandhiResultDisplay.textContent !== 'N/A' && !sandhiResultDisplay.textContent.startsWith('Error')) {
                // Use execCommand for broader compatibility within iframes
                const textarea = document.createElement('textarea');
                textarea.value = textToCopy;
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    showMessage('परिणामः विवरणैः सह प्रतिलिपीकृतः!', 'success');
                } catch (err) {
                    console.error('Failed to copy text:', err);
                    showMessage('प्रतिलिपिः न कृता। कृपया स्वयं प्रतिलिपिं करोतु।', 'error');
                }
                document.body.removeChild(textarea);
            } else {
                showMessage('प्रतिलिपिं कर्तुं परिणामः नास्ति।', 'info');
            }
        });

        // Initial setup for responsive design
        window.addEventListener('load', () => {
            // Tailwind CSS classes handle most responsiveness directly.
            // No additional JS needed here unless for specific complex responsive logic.
        });

        /**
         * Appends a new chat interaction to the chat history UI.
         * @param {string} word1 The first input word.
         * @param {string} word2 The second input word.
         * @param {object} result The sandhi result object.
         */
        function appendChatHistory(word1, word2, result) {
            const chatEntry = document.createElement('div');
            chatEntry.classList.add('bg-gray-100', 'p-3', 'rounded-lg', 'shadow-sm', 'text-sm');

            chatEntry.innerHTML = `
                <p class="text-gray-700"><span class="font-semibold">Input:</span> ${word1} + ${word2}</p>
                <p class="text-gray-700"><span class="font-semibold">Result:</span> ${result.sandhiResult} (<span class="text-gray-600">${result.sandhiMeaning}</span>)</p>
                <p class="text-gray-600"><span class="font-semibold">Type:</span> ${result.sandhiType} | <span class="font-semibold">Sutra:</span> ${result.sutraName} (${result.sutraNumber})</p>
            `;

            chatHistoryDiv.appendChild(chatEntry);
            chatHistoryDiv.scrollTop = chatHistoryDiv.scrollHeight; // Scroll to the bottom
        }
    </script>
    <footer class="mt-8 text-center text-gray-600 text-sm">
        <p><strong>© २०२५ सन्धि शब्द संयोजकम् ससिधरकश्यपेन | सर्वाधिकार सुरक्षित।</strong></p>
    </footer>
</body>
</html>`
