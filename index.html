<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sandhi Word Combiner</title>
    <!-- Tailwind CSS for responsive styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font for a clean look */
        body {
            font-family: "Inter", sans-serif;
            background-color: #f0f4f8; /* Light gray background */
        }
        /* Style for loading indicator */
        .loader {
            border: 4px solid #f3f3f3; /* Light grey */
            border-top: 4px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 20px; /* Slightly smaller loader */
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-left: 12px; /* Increased margin */
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Basic transition for result display */
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        #sandhiResult {
            font-family: 'Noto Sans Devanagari', 'Inter', sans-serif;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;700&display=swap" rel="stylesheet">
</head>
<body class="flex items-center justify-center min-h-screen p-4 sm:p-6 lg:p-8">
    <div class="bg-white p-6 sm:p-8 rounded-xl shadow-lg w-full max-w-md border border-gray-200">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">Sandhi Word Combiner</h1>

        <!-- Input for the first word -->
        <div class="mb-4">
            <label for="firstWord" class="block text-gray-700 text-sm font-semibold mb-2">First Word:</label>
            <input type="text" id="firstWord" placeholder="Enter the first word"
 class="shadow-sm appearance-none border border-gray-300 rounded-lg w-full py-3 px-4 pr-10 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 ease-in-out">
 <button class="clearButton absolute inset-y-0 right-0 flex items-center px-2 text-gray-600 hover:text-gray-800 focus:outline-none" style="top: 50%; transform: translateY(-50%); right: 10px;">
 <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
 <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L10 8.586 7.707 6.293a1 1 0 00-1.414 1.414L8.586 10l-2.293 2.293a1 1 0 001.414 1.414L10 11.414l2.293 2.293a1 1 0 001.414-1.414L11.414 10l2.293-2.293z" clip-rule="evenodd" />
 </svg>
 </button>
        </div>

        <!-- Input for the second word -->
        <div class="mb-6">
            <label for="secondWord" class="block text-gray-700 text-sm font-semibold mb-2">Second Word:</label>
            <input type="text" id="secondWord" placeholder="Enter the second word"
 class="shadow-sm appearance-none border border-gray-300 rounded-lg w-full py-3 px-4 pr-10 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 ease-in-out">
 <button class="clearButton absolute inset-y-0 right-0 flex items-center px-2 text-gray-600 hover:text-gray-800 focus:outline-none" style="top: 50%; transform: translateY(-50%); right: 10px;">
 <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
 <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L10 8.586 7.707 6.293a1 1 0 00-1.414 1.414L8.586 10l-2.293 2.293a1 1 0 001.414 1.414L10 11.414l2.293 2.293a1 1 0 001.414-1.414L11.414 10l2.293-2.293z" clip-rule="evenodd" />
 </svg>
 </button>
        </div>

        <!-- Button to perform sandhi operation -->
        <button id="combineButton"
                class="w-full bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition duration-200 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 flex items-center justify-center">
            Combine Words (Sandhi)
        </button>

        <!-- Display area for the sandhi result -->
        <div id="resultContainer" class="mt-8 p-4 bg-blue-50 rounded-lg border border-blue-200 hidden fade-in relative">
            <!-- Loading indicator -->
            <div id="loadingIndicator" class="loader hidden absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-10"></div>
            <p class="text-gray-700 text-sm font-semibold mb-2">Sandhi Result (Sanskrit):</p>
            <p id="sandhiResult" class="text-2xl font-extrabold text-blue-800 break-words mb-4"></p>
            <p class="text-gray-700 text-sm font-semibold mb-2">Meaning (English):</p>
            <p id="sandhiMeaning" class="text-lg text-gray-700 break-words mb-4"></p>

            <p class="text-gray-700 text-sm font-semibold mb-2">Type of Sandhi:</p>
            <p id="sandhiType" class="text-lg text-gray-700 break-words mb-4"></p>

            <p class="text-gray-700 text-sm font-semibold mb-2">Ashtadhyayi Sutra Name:</p>
            <p id="sutraName" class="text-lg text-gray-700 break-words mb-4"></p>

            <p class="text-gray-700 text-sm font-semibold mb-2">Ashtadhyayi Sutra Number:</p>
            <p id="sutraNumber" class="text-lg text-gray-700 break-words"></p>

<!-- Copy to clipboard button -->
            <button id="copyButton"
                    class="mt-4 w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-lg shadow-sm transition duration-200 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-opacity-50">
                Copy Result
            </button>
        </div>
        <!-- Message box for errors or important info -->
        <div id="messageBox" class="hidden mt-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg text-sm" role="alert">
            <!-- Messages will be displayed here -->
        </div>
    </div>

    <script>
        // Get references to HTML elements
        const firstWordInput = document.getElementById('firstWord');
        const secondWordInput = document.getElementById('secondWord');
        const combineButton = document.getElementById('combineButton');
        const sandhiResultDisplay = document.getElementById('sandhiResult');
        const sandhiMeaningDisplay = document.getElementById('sandhiMeaning');
        const sandhiTypeDisplay = document.getElementById('sandhiType');
        const sutraNameDisplay = document.getElementById('sutraName');
        const sutraNumberDisplay = document.getElementById('sutraNumber');
        const resultContainer = document.getElementById('resultContainer');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const clearButtons = document.querySelectorAll('.clearButton');
        const copyButton = document.getElementById('copyButton');
        const messageBox = document.getElementById('messageBox');

        /**
         * Displays a message in the message box.
         * @param {string} message The message to display.
         * @param {string} type The type of message ('success', 'error', 'info').
         */
        function showMessage(message, type = 'info') {
            messageBox.textContent = message;
            messageBox.classList.remove('hidden', 'bg-green-100', 'border-green-400', 'text-green-700', 'bg-red-100', 'border-red-400', 'text-red-700', 'bg-blue-100', 'border-blue-400', 'text-blue-700');
            messageBox.classList.add('block'); // Ensure it's visible

            if (type === 'success') {
                messageBox.classList.add('bg-green-100', 'border-green-400', 'text-green-700');
            } else if (type === 'error') {
                messageBox.classList.add('bg-red-100', 'border-red-400', 'text-red-700');
            } else { // default to info
                messageBox.classList.add('bg-blue-100', 'border-blue-400', 'text-blue-700');
            }

            // Hide after 5 seconds
            setTimeout(() => {
                messageBox.classList.add('hidden');
            }, 5000);
        }

        /**
         * Performs a sandhi operation by calling the Gemini API to simulate
         * a backend processing the words with a sandhi module,
         * requesting result, type, sutra name, and sutra number, and meaning.
         * @param {string} word1 The first word.
         * @param {string} word2 The second word.
         * @returns {Promise<object>} A promise that resolves with an object containing sandhiResult, sandhiMeaning, sandhiType, sutraName, and sutraNumber.
         */
        async function performSandhi(word1, word2) {
            loadingIndicator.classList.remove('hidden'); // Show loader
            combineButton.disabled = true; // Disable button
            messageBox.classList.add('hidden'); // Hide any previous messages
            resultContainer.classList.add('hidden'); // Hide results while calculating

            try {
                showMessage("Performing sandhi operation...", "info");

                let chatHistory = [];
                // Prompt the LLM to act as a sandhi calculator and return JSON
                const prompt = `Perform Sanskrit sandhi for the words "${word1}" and "${word2}". Provide the combined sandhi word, its English meaning, the type of sandhi (e.g., Vowel Sandhi, Consonant Sandhi, Visarga Sandhi), and if applicable, the Ashtadhyayi Sutra name and number that governs this sandhi. Return the response in a JSON object with keys "sandhiResult", "sandhiMeaning", "sandhiType", "sutraName", and "sutraNumber". If a sutra or meaning is not directly applicable or known, use "N/A" for its values. Do not include any other text or explanation outside the JSON.`;
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });

                const payload = {
                    contents: chatHistory,
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "OBJECT",
                            properties: {
                                "sandhiResult": { "type": "STRING" },
                                "sandhiMeaning": { "type": "STRING" },
                                "sandhiType": { "type": "STRING" },
                                "sutraName": { "type": "STRING" },
                                "sutraNumber": { "type": "STRING" }
                            },
                            "propertyOrdering": ["sandhiResult", "sandhiMeaning", "sandhiType", "sutraName", "sutraNumber"]
                        }
                    }
                };
                const apiKey = "AIzaSyBetJYG7cFgFjYFyPuqGYbfpHTdxPUObgg" ; // Canvas will provide this in runtime
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`API error! Status: ${response.status}, Details: ${errorText}`);
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const jsonString = result.candidates[0].content.parts[0].text;
                    const parsedJson = JSON.parse(jsonString);

                    const sandhiResult = parsedJson.sandhiResult ? parsedJson.sandhiResult.trim() : 'N/A';
                    const sandhiMeaning = parsedJson.sandhiMeaning ? parsedJson.sandhiMeaning.trim() : 'N/A';
                    const sandhiType = parsedJson.sandhiType ? parsedJson.sandhiType.trim() : 'N/A';
                    const sutraName = parsedJson.sutraName ? parsedJson.sutraName.trim() : 'N/A';
                    const sutraNumber = parsedJson.sutraNumber ? parsedJson.sutraNumber.trim() : 'N/A';

                    return { sandhiResult, sandhiMeaning, sandhiType, sutraName, sutraNumber };
                } else {
                    showMessage('Unexpected response structure from the sandhi service.', 'error');
                    return { sandhiResult: 'Error', sandhiMeaning: 'N/A', sandhiType: 'N/A', sutraName: 'N/A', sutraNumber: 'N/A' };
                }
            } catch (error) {
                console.error('Error performing sandhi:', error);
                showMessage(`Error: ${error.message}. Please try again.`, 'error');
                return { sandhiResult: 'Error', sandhiMeaning: 'N/A', sandhiType: 'N/A', sutraName: 'N/A', sutraNumber: 'N/A' };
            } finally {
                loadingIndicator.classList.add('hidden'); // Hide loader
                combineButton.disabled = false; // Enable button
            }
        }

        // Add event listener to the combine button
        combineButton.addEventListener('click', async () => {
            const firstWord = firstWordInput.value.trim();
            const secondWord = secondWordInput.value.trim();

            if (!firstWord || !secondWord) { // Input validation
                resultContainer.classList.add('hidden'); // Hide results
                showMessage("Please enter both words to perform sandhi.", "error");
                return;
            }

            sandhiResultDisplay.textContent = "Calculating...";
            sandhiMeaningDisplay.textContent = "";
            sandhiTypeDisplay.textContent = "";
            sutraNameDisplay.textContent = "";

            const result = await performSandhi(firstWord, secondWord);

            if (result.sandhiResult.startsWith("Error")) {
                sandhiResultDisplay.textContent = result.sandhiResult;
                sandhiMeaningDisplay.textContent = result.sandhiMeaning;
                sandhiTypeDisplay.textContent = result.sandhiType;
                sutraNameDisplay.textContent = result.sutraName;
                sutraNumberDisplay.textContent = result.sutraNumber;
                resultContainer.classList.remove('hidden'); // Show container even on error
                resultContainer.classList.add('fade-in');
            } else {
                sandhiResultDisplay.textContent = result.sandhiResult;
                sandhiMeaningDisplay.textContent = result.sandhiMeaning;
                sandhiTypeDisplay.textContent = result.sandhiType;
                sutraNameDisplay.textContent = result.sutraName;
                sutraNumberDisplay.textContent = result.sutraNumber;
                resultContainer.classList.remove('hidden'); // Show container
                resultContainer.classList.add('fade-in');
                showMessage("Sandhi operation completed!", "success");
            }
        });

        // Add event listener for the copy button
        copyButton.addEventListener('click', () => {
            // Get all relevant text for copying, separated by newlines
            const textToCopy = `Sandhi Result: ${sandhiResultDisplay.textContent}\n` +
                               `Meaning: ${sandhiMeaningDisplay.textContent}\n` +
                               `Sandhi Type: ${sandhiTypeDisplay.textContent}\n` +
                               `Ashtadhyayi Sutra Name: ${sutraNameDisplay.textContent}\n` +
                               `Ashtadhyayi Sutra Number: ${sutraNumberDisplay.textContent}`;

            if (sandhiResultDisplay.textContent && sandhiResultDisplay.textContent !== 'N/A' && !sandhiResultDisplay.textContent.startsWith('Error')) {
                // Use execCommand for broader compatibility within iframes
                const textarea = document.createElement('textarea');
                textarea.value = textToCopy;
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    showMessage('Result and details copied to clipboard!', 'success');
                } catch (err) {
                    console.error('Failed to copy text:', err);
                    showMessage('Failed to copy. Please copy manually.', 'error');
                }
                document.body.removeChild(textarea);
            } else {
                showMessage('No result to copy.', 'info');
            }
        });

        // Initial setup for responsive design
        window.addEventListener('load', () => {
            // Tailwind CSS classes handle most responsiveness directly.
            // No additional JS needed here unless for specific complex responsive logic.
        });

        // Add event listeners for clear buttons
        clearButtons.forEach(button => {
            button.addEventListener('click', (event) => {
                 const inputField = button.parentElement.querySelector('input[type="text"]');
                    inputField.value = '';
                    inputField.focus(); // Set focus back to the cleared input
                }
            , { passive: true });
        });
    </script>
    <!-- Footer -->
<footer class="mt-12 text-center text-gray-500 text-sm py-4 border-t border-gray-200 bg-white opacity-90 rounded-b-xl shadow-inner">
    <div>
        © 2025 Sandhi Word Combiner by Sasidhara-Kashyap0903. All rights reserved.
    </div>
    <div class="mt-1">
        <a href="https://github.com/sasidhara-kashyap0903/Phonetic-Sandhi.github.io" class="text-blue-500 hover:underline">View on GitHub</a>
    </div>
</footer>
</body>
</html>`
